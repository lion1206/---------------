def get_r1():
    while True:
        rstr = input("Введите ключ 64 символа 0 и 1: ")
        if len(rstr) != 64:
            print("Ключ должен быть 64 символов")
            continue
        if not all(char in '01' for char in rstr):
            print("Ключ должен состоять только из 1 и 0")
            continue

        r1 = [0]*19
        r2 = [0]*22
        r3 = [0]*23
        for i in range(64):
            r1t = r1[18]^r1[17]^r1[16]^r1[13]^int(rstr[i]) 
            r1.insert(0,r1t)
            r1.pop(19)

            r2t = r2[21]^r2[20]^int(rstr[i]) 
            r2.insert(0,r2t)
            r2.pop(22)
            
            r3t = r3[22]^r3[21]^r3[20]^r3[7]^int(rstr[i])
            r3.insert(0,r3t)
            r3.pop(23)
            
        print(r1)
        print(r2)
        print(r3)
        break

    return r1, r2, r3

def generate_gamma_block(r1, r2, r3):
    block = []
    # Создаем копии регистров для обработки блока
    reg1 = r1.copy()
    reg2 = r2.copy()
    reg3 = r3.copy()
    
    for _ in range(114):
        gamma_bit = reg1[-1] ^ reg2[-1] ^ reg3[-1]
        block.append(gamma_bit)
        
        # Обновление регистров
        fb_r1 = reg1[18] ^ reg1[17] ^ reg1[16] ^ reg1[13]
        fb_r2 = reg2[21] ^ reg2[20]
        fb_r3 = reg3[22] ^ reg3[21] ^ reg3[20] ^ reg3[7]
        
        reg1 = [fb_r1] + reg1[:-1]
        reg2 = [fb_r2] + reg2[:-1]
        reg3 = [fb_r3] + reg3[:-1]
    
    return block, reg1, reg2, reg3

class GammaGenerator:
    def __init__(self, r1, r2, r3):
        self.r1 = r1
        self.r2 = r2
        self.r3 = r3
        self.buffer = []
    
    def get_bits(self, n):
        while len(self.buffer) < n:
            block, self.r1, self.r2, self.r3 = generate_gamma_block(self.r1, self.r2, self.r3)
            self.buffer.extend(block)
        
        result = self.buffer[:n]
        self.buffer = self.buffer[n:]
        return result
    
    def get_byte(self):
        bits = self.get_bits(8)
        byte_val = 0
        for bit in bits:
            byte_val = (byte_val << 1) | bit
        return byte_val

def encrypt_message(message, gamma_gen):
    encrypted_array = []
    for char in message:
        gamma_byte = gamma_gen.get_byte()
        ascii_value = ord(char)
        encrypted_byte = ascii_value ^ gamma_byte
        encrypted_array.append(format(encrypted_byte, '08b'))
    return encrypted_array

def decrypt_message(encrypted_array, gamma_gen):
    decrypted_message = ""
    for binary_str in encrypted_array:
        gamma_byte = gamma_gen.get_byte()
        encrypted_byte = int(binary_str, 2)
        decrypted_byte = encrypted_byte ^ gamma_byte
        decrypted_message += chr(decrypted_byte)
    return decrypted_message

while True:
    print("\nМеню:")
    print("1. Зашифровать сообщение")
    print("2. Расшифровать сообщение")
    print("3. Выход")
    choice = input("Выберите действие: ")

    if choice == '1':
        r1, r2, r3 = get_r1()
        gamma_gen = GammaGenerator(r1, r2, r3)
        message = input("Введите сообщение для шифрования: ")
        encrypted = encrypt_message(message, gamma_gen)
        print("Зашифрованное сообщение:", " ".join(encrypted))
    elif choice == '2':
        r1, r2, r3 = get_r1()
        gamma_gen = GammaGenerator(r1, r2, r3)
        encrypted_message = input("Введите зашифрованное сообщение (в двоичном формате, разделенное пробелами): ").split()
        decrypted = decrypt_message(encrypted_message, gamma_gen)
        print("Расшифрованное сообщение:", decrypted)
    elif choice == '3':
        print("Выход из программы.")
        break
    else:
        print("Неверный выбор. Пожалуйста, выберите 1, 2 или 3.")


##1111111100000000111111110000000011111111000000001111111100000000

##Когда Андрей Болконский едет в имение Отрадное, он видит старый дуб. Встреча Андрея Болконского и дуба происходит в тяжёлые моменты жизни главного героя, разочаровавшись в Наполеоне, в войне и в себе самом, он не видит смысла своего существования. Князь Андрей видел перед собой огромный, в два обхвата, дуб. Однако суки и кора его были обломаны, потому что дерево было довольно старым. На коре были старые болячки. Дуб стоял на краю дороги, что подчёркивает его одиночество. Он один был старым, сердитым и презрительным уродом среди улыбающихся берёз. Несмотря на то что под дубом были цветы и трава, он всё равно стоял хмурясь, неподвижно, уродливо и упорно. Только дуб, который видел Андрей Болконский, не хотел подчиняться обаянию весны. Он не видел ни эту весну, ни солнце. Дуб будто бы говорил, что всё это глупый бессмысленный обман и что он не верит этим надеждам и обманам. Однако при следующей встрече князя Андрея с этим же дубом он был без корявых пальцев и без болячек. Наоборот, через кору пробивались сочные молодые листья. В нём не было видно старого горя и недоверия.
##10000011111 10011011001 10011001110 10000111000 10011010110 01011000 10010110100 10001010100 10010000110 10001001010 10000100111 10000111000 10100000 10010000101 10011101011 10000110100 10010111101 10010011111 10010000010 10011011010 10001111011 10000100101 10001110111 00011110 10011101100 10010100101 10000011100 10001110011 11000010 10001011010 00110100 10001100011 10000010000 10011100110 10011010100 10000110011 10001111001 00101100 10011101111 10010101110 10010001100 10010000011 10001111101 10001111111 10001111110 10010011100 11110000 01000100 10011101101 10000010100 00000100 10001100010 10000111101 10000101101 10010011000 10011101101 00101100 10010011011 10001011101 10000000100 10000111001 10010110110 10000100010 10101101 10011100010 10000011001 10011100000 10100110 00111110 10011000011 10000101001 10011010010 10011110100 10000101100 10010111011 10001011110 10101010 10010000001 10000010000 10000001000 10011101000 10001111000 10001000110 01010011 10011110000 10011111110 10011111001 10011001110 10011111111 10010010010 10001110101 10001011101 10000001010 10000001101 10000100010 00010000 10011100011 01011111 10000110110 10011100001 10010100111 10010111010 01001100 10011100110 10000111011 10010111011 10001001100 10000100110 10010111000 10011111010 10000100010 10000000110 10011101000 10000011 10001100010 10111101 10010000111 10001001011 10011001111 10000011101 10001001010 10010000010 10011100111 10101001 10001001010 10000001110 10010001001 10000110111 10011010100 10011001010 10000110111 00000001 10001100111 10010100011 10010111111 10010101110 10001000111 01101111 10001001000 10000101100 10010111100 10011001111 10010011101 10001100110 10000100110 10001111010 11101101 10000110011 10011101001 10001110101 10011110000 10000010101 11000010 10011101 10011010011 10000110001 10000100000 10001011001 10001001110 10001001110 10011100000 10010010001 10011011110 10010100011 10001000101 10011011001 10011101110 10011001101 10000011111 01111000 10001011111 10111110 10000000100 10010101111 10011101100 10001111110 10011001000 10001001101 10000010100 10010110101 10001000101 10100101 10011101 10011111101 00001011 10000001011 10011000001 10000010010 10010100100 10010101000 11010110 10011111101 01110111 10011011011 10010110 10000011011 10011111011 10011001100 10011111100 10001001 10010001111 10000010110 10001100011 10000010100 10011000101 00010100 00101101 10010001111 10001111100 10000001 10010000001 10000011111 01100000 10001100110 10000111101 10011101011 10000101010 10011001110 01011110 10010101100 10001000001 10001010110 10010100111 10010110010 10010010010 11101110 10000000101 10011111100 10000011110 10000101000 10000101000 10000000111 01011011 10011000101 10011100001 10000100111 10000111011 10001100000 10000110111 10001110101 10010111100 10001111000 10001110000 10000000010 10011011110 10010010101 01110110 01110010 10010100001 10000011111 10000101110 10011010101 10011010111 00100011 10000110111 10011001100 10000001110 10000011111 10001101111 10010001011 11111011 10010111000 10001101010 10011111110 10010000111 10010011110 01000010 10011010100 10010101000 10011011111 10010011001 10011110011 11000111 10001000101 10010110010 10000111101 10001011100 10010011100 00011001 10010110010 10000000101 10000101000 10010001111 10010101000 10011110100 10000011000 10010011010 10000000 11100001 10000110110 00011111 10011110101 10010001111 10000000101 00010001 10000101101 10000101011 10001011001 10001101011 10010101110 10011101001 10010000101 01010001 00110101 10000110101 10010110010 10001000000 10100010 11010010 10001101001 10011010001 10000010101 10011101011 10000010000 10011111001 00010010 10011001010 10010111111 10001101000 10011111110 10110001 10010110101 00101101 10000000111 10010011101 10001010110 10001001001 01100100 10000111000 10011110010 10010111100 01110110 10000110100 10010001100 10011010001 10001110010 10011000 10001100101 10010111110 10011011011 10000001011 10011000110 10010001000 10010101101 10001100110 10101011 10101111 10000000001 10000001011 10000010111 10010110011 10001010010 10011101110 11011100 10010001100 10001001011 10001010110 00101001 10001000001 10011001100 10001111100 10010010001 10011000010 10011011010 11000000 10011101100 10011001110 10000011001 10010110010 10101000 10010110110 10010101101 10010010010 10000001110 10000001100 10011000110 10010101010 10011100101 01001101 10000100010 10011110111 10010010000 10010101100 10010101000 10010101011 11110001 01010000 10001001110 10011001000 01000000 10011110001 10011001100 10001111101 10011010110 01000010 10001011010 10001001000 10001000011 10001100010 11100100 10011110001 10011001001 10010001110 10010011010 10010011111 10010101000 00010111 10010100111 10011010101 10011011100 10001011000 10000100001 10010111110 10001010000 11101101 01010110 10001000110 10001001100 10001000100 01001000 10010001010 10000011110 10010111111 10001000100 10011001110 10011001 10011111100 10010010101 10101110 10000000101 10001011001 10001010010 10001100101 10111011 10001111000 10000101000 10011010110 10011111101 10011101100 10001011110 10001000 11111110 10010001111 10010111111 10000110101 01110100 10000010101 10011100110 10001110111 10001111100 10011001111 10000100001 10000100010 10010110001 10001110101 10011011000 10000010000 10010010110 01000100 10001101101 10011101011 10010010101 11010111 10011100011 10011011000 10000111011 10000000110 10010000111 10001010000 10000010000 10010010000 10011111110 10010000000 10011111100 00011110 11010010 10010100110 10011001111 01111000 10010000101 10001111001 10010110000 10011011111 01010110 10001011111 10001101000 10001100110 01110011 10010001010 10010011000 10010010110 10011010010 10010110011 10010100001 01111111 10010001 10010111010 10000010011 10001000100 10000001101 10001100111 10001001111 10011101100 10011110101 11000001 10010110111 11111100 10010000111 10001011010 10001000001 10001011001 10001111001 10001001100 10011111011 10010101110 10010100111 10001010010 10011000100 10001111011 10001111000 11001111 10011100010 10010101000 10000111100 10011000001 10000101111 10000011000 11101010 10010111011 10001100000 10000011011 10010011000 10000111011 10110011 10010011101 10000000001 10010000111 10000100001 10010111001 10001101011 10010001101 10010001010 10001011011 10000111100 10000101011 10110011 10010101110 10011010111 10000100000 10010011101 10000001111 00000011 10010101 10011000101 10010111000 10010000101 10000111000 10001100000 10000010111 10011000000 10011110110 01110100 10010101011 10010110100 01011010 10001001010 10011111100 01011110 10001101001 10000100001 10001011011 11011110 10000001000 10001101010 10011010101 10101111 10011000110 10001011011 10000101000 10011010111 10010000001 11001110 10011101000 10011010000 10010101000 10001101011 00110101 10000001100 10000100010 10001101011 10001101111 10011010101 01010111 10010110000 00000001 10010000110 10000110110 10001111101 10010000011 10011000000 00010001 00100110 10011000000 10011011010 10101011 10010010101 10011100000 10001101011 11011010 10011110001 10000100111 10000000011 10001101100 10001011001 10111101 10011011110 10011011010 10011110101 10011010100 10010110101 00010100 10001010100 10000011011 10000011010 10000100111 10000010101 10010110000 10000001100 00110010 01111010 10001001010 10001000010 10010010001 10011101011 10001001010 10000000110 10000101111 10011001001 10000110111 10011001000 01010001 00100010 10011000101 10011101111 10000100101 10011101100 10000111111 10001110100 10001110110 10000110011 11001111 10000100011 00100010 10010111101 10001011101 10011111011 10000110011 10011110011 10001111101 01010101 00101000 10000001110 10000110000 10000010010 10000001111 10011011101 10001001101 11111000 10001010100 10011110110 10010001111 00111011 11000111 10000101100 10010111110 10000000000 10011111101 10001101011 10010000000 10000100111 01111011 10011010000 10011011001 10011101010 10000011010 10011111010 00110100 10001001111 10001101110 10001000010 10011111100 10001100101 10011100110 01010110 10010010101 10000000101 10010000100 10000101001 10001100001 10000011010 10011100011 10011011101 10001111110 10010100110 11111000 01001000 10010010100 10010001010 11011011 10001010111 10000001001 10000000000 10000100001 10001111000 10101000 10011001011 10011110100 10010011110 10001001101 10010101110 10010111111 10001101100 10000100001 10001010101 10000010111 10011101111 10101101 10000111001 10011000000 10000010010 10001101010 10010111010 10010000101 10000100100 11111101 10010111111 10000111001 10011000011 10001110000 10001100001 10111101 00011101 10011111000 10000010011 00100001 10010000000 10000101100 10111101 10001111001 10000101001 10001001011 10011101000 10001110001 01110101 10010100111 10010011010 11101011 10000111001 10000001010 10010100101 00100000 10000001001 10010010110 10001000010 10011101100 10010010001 01001001 01010000 10000001100 10011100111 00010010 10010000111 10011100000 10001011000 10011101101 10000110110 10000111111 01000111 11001101 10001001111 10001110110 10011110010 00010011 10011001011 10001001100 10011001100 10000101010 10011011101 00001001 10010110001 10011101100 10011001 10010011101 10010001101 10011100010 10011111100 10010111111 10000101111 10010010101 11010101 10011011 10011010110 10001001110 10001111100 00111101 10011010001 10010100101 10001001101 00000010 10011101110 10010111100 10011010110 01000110 10010011111 10010011001 10011001010 10011010011 10000001011 10011010000 11000001 10000111011 10010010001 10011100101 10011101000 10010100111 10010101011 10010000101 10001111111 10001001000 10010010100 10011001101 10001110001 10000000111 10001010 10001110111 10001000010 10011101000 10000111010 10001100101 10010100 10011111111 11010101 10011001100 10011000100 10011111100 00000110 10000111111 10010001010 00101100 10011011111 10010110010 00001101 10011010110 10010000000 10010000011 10011010010 10000101100 01000100 10001000100 10010101100 10000011001 10011100001 10111010 10000101111 10011101001 10011000101 10001011001 10000001100 10001111011 10010000011 10011010110 10001001 10000011011 10101000 10001100111 10011011001 10011101100 10010000111 10001100000 10010100100 10001100011 10011001 01110100 10011101010 10001011111 10010111010 10011101001 10000101000 10010010100 01100111 10010010000 10001011001 10001001000 00011101 10000010011 10000101001 10001011001 10010010110 10000100000 10001101111 10010000011 10000101001 10010001100 11111010 10001100000 10011101010 10001111011 10001100100 10011110100 10000100111 10010011110 00001101 10001100110 10000100000 10000000011 10000011011 10011000111 01001011 10010011101 10001101010 10001111101 10010111111 10001001110 10001110110 00011010 10000110010 00000101 10011010110 10001101001 10000101010 10011101111 10001100 10000001011 10011011101 01110011 10010111011 10000101011 10010010111 10000010111 10011110000 10100100 10000101100 10010111010 10111000 10010110001 10000001011 10001011111 10110010 10000111000 10010000011 10000100010 00011010 10010010101 10001000100 10011100111 10000011010 10000101100 10011001110 10000101101 01111001 10010100000 10010001000 10011011010 10010101110 10000000011 10001110110 10010001011 10000011 10001101100 01111110 10000001110 10000110000 10011001011 00100100 10010001111 10001010110 10001110010 10010011110 10010101011 10000111110 10010101010 10110000 11010111 10001001010 10010010011 10011011000 10010001010 10000001100 10000101001 10000100000 10011001111 11100010 10000100 10010001011 10011100000 10000001110 10011000110 10001000011 10100101 10000111011 10010010010 10011000010 10000100100 10101111 10011100000 10001000100 10010011000 10010100000 10010100110 10001001111 10001111111 10010100010 10000101011 10011010000 10011001000 10100001 10001101000 10001110111 10010100111 10011101001 10010000110 10000011001 11011000 10001010101 10010010111 10001001011 10011111000 10000110000 10000101010 10001001101 00000011 10011111010 10000000100 10001011011 10010100100 10000010100 10001110000 11101100 00000100 10001100100 00110000 10001001110 10010010111 10000100111 01100011 10011000110 10000011011 00000010 10011000111 10000100111 10001111010 10000100101 10101000 10010110111 10010001100 10011010001 10000101100 10011110000 00101111 10010011110 10000010110 10010100111 10001001110 10001010010 10000011000 10001111001 10000010 10010100110 10010011000 10011001011 10000111011 10001000 10011010111 11101110 10011100111 10011010100 10000111011 10001011111 10000000001 10011001100 10001111000 10001011000 10010011111 10011101